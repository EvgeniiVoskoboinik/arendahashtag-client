<app-tabset [@fadeIn]="''" [@slideLeft]="''"
            [selectedKey]="selectedTab?.key"
            (select)="onTabSelected($event)">
  <app-tab *ngFor="let tab of tabs"
           [key]="tab.key">{{ tab.name }}</app-tab>
</app-tabset>

<div *ngIf="selectedTab" class="form-container">
  <div class="form-item">
    <h4>Населенный пункт <span class="required-asterisk" title="Обязательное поле">*</span></h4>
    <app-dropdown
      [placeholder]="dropdownPlaceholder"
      [searching]="true"
      [clientSearching]="false"
      [items]="cities"
      [selectedItems]="adState.city"
      [searchDebounce]="300"

      (selectedItemChange)="onSelectedChange('city', $event)"
      (searchChange)="onCitySearchChange($event)"
    ></app-dropdown>
  </div>
  <div class="form-item"></div>

  <div class="form-item">
    <h4>Тип объявления <span class="required-asterisk" title="Обязательное поле">*</span></h4>
    <app-dropdown
      [placeholder]="dropdownPlaceholder"
      [items]="adTypes"
      [selectedItems]="adState.adType"
      (selectedItemChange)="onSelectedChange('adType', $event)"
    ></app-dropdown>
  </div>

  <div class="form-item">
    <ng-container *ngIf="isRentSelected">
      <h4>Срок аренды <span class="required-asterisk" title="Обязательное поле">*</span></h4>
      <app-dropdown
        [placeholder]="dropdownPlaceholder"
        [items]="leaseTerms"
        [selectedItems]="adState.leaseTerm"
        (selectedItemChange)="onSelectedChange('leaseTerm', $event)"
      ></app-dropdown>
    </ng-container>
  </div>

  <div class="form-item">
    <h4>Вид недвижимости <span class="required-asterisk" title="Обязательное поле">*</span></h4>
    <app-dropdown
      [placeholder]="dropdownPlaceholder"
      [items]="propertyTypes"
      [selectedItems]="adState.propertyType"
      (selectedItemChange)="onSelectedChange('propertyType', $event)"
    ></app-dropdown>
  </div>

  <div class="form-item">
    <ng-container *ngIf="ispropertyContainsRooms">
      <h4>Количество комнат</h4>
      <app-dropdown
        [placeholder]="dropdownPlaceholder"
        [items]="roomsCount"
        [selectedItems]="adState.roomsCount"
        (selectedItemChange)="onSelectedChange('roomsCount', $event)"
      ></app-dropdown>
    </ng-container>
  </div>

  <div class="form-item">
    <h4>Кто разместил</h4>
    <app-dropdown
      [placeholder]="dropdownPlaceholder"
      [items]="advertiserTypes"
      [selectedItems]="adState.advertiser"
      (selectedItemChange)="onSelectedChange('advertiser', $event)"
    ></app-dropdown>
  </div>
  <div class="form-item"></div>

  <textarea autosize class="ad-description"
    *ngIf="selectedTab.key === 'create'"
    [ngModel]="adState.description"
    (ngModelChange)="onSelectedChange('description', $event)"
    placeholder="Текст объявления"
  ></textarea>

  <app-photo-upload
    *ngIf="selectedTab.key === 'create'"
    (fileChange)="onFileChange($event)"
  ></app-photo-upload>

  <div class="button-container full-width" *ngIf="!attachmentsLoaded">
    <button class="btn btn-main" (click)="loadAttachments()">
      <span *ngIf="!attachmentsLoading">Загрузить выбранные фотографии</span>
      <span *ngIf="attachmentsLoading"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i></span>
    </button>
  </div>

  <div class="required-notification">* - обязательные поля</div>

  <div class="full-width next-button-container">
    <div class="error-container" *ngIf="errorMsg">{{errorMsg}}</div>
    <button class="btn btn-main"
            (click)="onClickNext()"
            [disabled]="loading"
    >
      <span *ngIf="!loading">{{selectedTab.buttonTitle}}</span>
      <span *ngIf="loading"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i></span>
    </button>
  </div>
</div>
